<!-- resources/js/Pages/Product/Category.vue -->



<!-- resources/js/Pages/Product/Category.vue -->

<template>
    <Head title="–†–∞–∑–¥–µ–ª—ã" />
    <div class="flex flex-col min-h-screen">
        <!-- HEADER -->
        <Header />

        <!-- MAIN -->
        <main class="w-full px-6 mx-auto max-w-[1000px]">
            <div
                v-for="product in products"
                :key="product.id"
                class="product-card mb-10  pb-8"
            >
                <div class="product-info">
                    <h1 class="text-4xl py-4 md:text-5xl font-bold mb-6 text-center bg-clip-text text-transparent
                    bg-gradient-to-r from-blue-500 to-purple-600">

                        {{ product.title }}
                    </h1>
<!--                    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-6 text-center">
                        {{ product.title }}
                    </h1>
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 drop-shadow-lg mb-6 text-center">
                        {{ product.title }}
                    </h1>

                    <div class="text-center mb-10">
                        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight">
                            {{ product.title }}
                        </h1>
                        <p class="text-lg md:text-xl text-gray-600 mt-4">
                            –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ —Å–ª–æ–≥–∞–Ω –ø—Ä–æ–¥—É–∫—Ç–∞
                        </p>
                    </div>-->


                    <div class="product-description max-w-full mb-6" v-html="product.description"></div>

                    <!-- –ù–æ–≤—ã–µ –±–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                    <div v-if="product.content_blocks">
                        <div
                            v-for="(block, index) in product.content_blocks"
                            :key="index"
                            class="mb-6"
                        >
                            <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ -->
                            <div v-if="block.type === 'text'" class="text-block" v-html="sanitizeBlock(block.description)"></div>

                            <!-- –§–æ—Ç–æ –±–ª–æ–∫ -->
                            <img
                                v-if="block.type === 'image' && block.image"
                                :src="`/storage/${block.image}`"
                                class="mx-auto my-4 rounded-lg shadow-sm"
                                style="max-width: 100%; height: auto;"
                            />

                            <!-- –ö–Ω–æ–ø–∫–∞ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –∏ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º -->
                            <div v-if="block.type === 'button'" class="flex flex-col items-center my-6 space-y-4">

                                <!-- –ß–µ–∫–±–æ–∫—Å—ã —Å–æ–≥–ª–∞—Å–∏–π -->
                                <div class="space-y-2 text-sm text-gray-700">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" v-model="consentPrivacy" />
                                        <span>–Ø –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å <Link href="/privacy" class="text-blue-600 underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</Link></span>
                                    </label>

                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" v-model="consentOferta" />
                                        <span>–Ø –ø—Ä–∏–Ω–∏–º–∞—é —É—Å–ª–æ–≤–∏—è <Link href="/oferta" class="text-blue-600 underline">–î–æ–≥–æ–≤–æ—Ä–∞ –æ—Ñ–µ—Ä—Ç—ã</Link></span>
                                    </label>
                                </div>

                                <!-- –ö–Ω–æ–ø–∫–∞ -->
                                <button
                                    :disabled="!consentPrivacy || !consentOferta"
                                    @click="openModal"
                                    class="inline-block w-full sm:w-auto px-10 py-3 text-lg font-semibold text-white text-center rounded-2xl shadow-md transition-all duration-300"
                                    :class="{
                                      'bg-gray-400 cursor-not-allowed': !consentPrivacy || !consentOferta,
                                      'bg-blue-600 hover:bg-blue-700 hover:shadow-lg active:scale-95': consentPrivacy && consentOferta
                                    }"
                                >
                                    {{ block.button_text }}
                                </button>
                        </div>
                    </div>


                </div>

                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div
                v-if="products.length === 0"
                class="text-center text-gray-500 py-10"
            >
                –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
            </div>
        </main>

        <!-- FOOTER -->
        <Footer />


        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div v-if="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-2xl shadow-lg w-96 relative">
                <button @click="closeModal" class="absolute top-2 right-3 text-gray-400 hover:text-gray-700 text-xl">&times;</button>
                <h2 class="text-xl font-semibold mb-4 text-center">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã</h2>

                <form @submit.prevent="submitForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ò–º—è</label>
                        <input
                            v-model="form.name"
                            type="text"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
                        />
                        <p v-if="errors.name" class="text-red-500 text-sm mt-1">{{ errors.name }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input
                            v-model="form.phone"
                            type="tel"
                            class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                            placeholder="+7 (___) ___-__-__"
                        />
                        <p v-if="errors.phone" class="text-red-500 text-sm mt-1">{{ errors.phone }}</p>
                    </div>

                    <button
                        type="submit"
                        class="w-full py-2 text-white bg-blue-600 rounded-xl font-semibold hover:bg-blue-700 transition"
                    >
                        –û–ø–ª–∞—Ç–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
</template>





<script setup>

import { ref } from 'vue'
import { onMounted, onBeforeUnmount } from 'vue'
import {Head, Link} from '@inertiajs/vue3'

import Header from '@/Components/Header.vue'
import Footer from '@/Components/Footer.vue'




const consentPrivacy = ref(false)
const consentOferta = ref(false)
const showModal = ref(false)




/***************** –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã **********/

const form = ref({
    name: '',
    phone: ''
})

const errors = ref({
    name: '',
    phone: ''
})

const openModal = () => {
    showModal.value = true
}

const closeModal = () => {
    showModal.value = false
    form.value = { name: '', phone: '' }
    errors.value = { name: '', phone: '' }
}

const submitForm = () => {
    errors.value = { name: '', phone: '' }

    if (!form.value.name.trim()) {
        errors.value.name = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è'
    }

    const phonePattern = /^\+?\d[\d\s\-\(\)]{9,}$/
    if (!phonePattern.test(form.value.phone)) {
        errors.value.phone = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'
    }

    if (!errors.value.name && !errors.value.phone) {
        /*alert(`‚úÖ –ò–º—è: ${form.value.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${form.value.phone}\n(—Ç—É—Ç –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ–ø–ª–∞—Ç—ã)`)*/
        closeModal()
    }
}

/***************** –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã **********/

/********************–ü–∞—É—Ç–∏–Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ **************/



onMounted(() => {
    // —ç–ª–µ–º–µ–Ω—Ç —Å –ø–∞—É—Ç–∏–Ω–æ–π
    const web = document.createElement('div')
    web.classList.add('web-bg')
    document.body.appendChild(web)

    // –≠—Ñ—Ñ–µ–∫—Ç –¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    const handleScroll = () => {
        const scrollOffset = window.scrollY * 0.2 // –º–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        web.style.transform = `translateY(${scrollOffset}px)`
    }

    // –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞ –æ—Ç –º—ã—à–∏
    const handleMouseMove = (e) => {
        const { innerWidth, innerHeight } = window
        const x = (e.clientX / innerWidth - 0.5) * 20 // -10 ... +10 px
        const y = (e.clientY / innerHeight - 0.5) * 20
        web.style.transform = `translate(${x}px, ${y + window.scrollY * 0.2}px)`
    }

    window.addEventListener('scroll', handleScroll)
    window.addEventListener('mousemove', handleMouseMove)

    onBeforeUnmount(() => {
        window.removeEventListener('scroll', handleScroll)
        window.removeEventListener('mousemove', handleMouseMove)
    })
})

/*******************–ü–∞—É—Ç–∏–Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ**************** */



defineProps({
    category: Object,
    products: Object,
})


// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ñ–µ—Ä—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
const preloadOferta = () => {
    router.preload('/oferta')
}

const sanitizeBlock = (html) => {
    if (!html) return ''
    // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ //storage/... –Ω–∞ /storage/...
    return html.replace(/src="\/\/storage\//g, 'src="/storage/')
}


</script>



<style >

.product-card {
    transition: all 0.3s ease;
}
.product-card:hover {
    transform: translateY(-2px);
}

.product-card {
    transition: transform 0.3s ease;
    will-change: transform;
}



/* –§–æ–Ω–æ–≤–∞—è –ø–∞—É—Ç–∏–Ω–∞ */
/*body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: url("/img/logo2.png") center top / cover no-repeat fixed;
    opacity: 0.05; /
    z-index: -1;
    pointer-events: none;
}*/



/* –§–æ–Ω–æ–≤–∞—è –ø–∞—É—Ç–∏–Ω–∞ */
.web-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: url("/img/logo2.png") center center / cover no-repeat;
    opacity: 0.03; /* –µ–ª–µ –∑–∞–º–µ—Ç–Ω–æ */
    z-index: -1; /* –ø–æ–¥ –≤—Å–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
    pointer-events: none;
    transition: transform 0.2s ease-out;
    will-change: transform;
}
/* –§–æ–Ω–æ–≤–∞—è –ø–∞—É—Ç–∏–Ω–∞ */



/* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã */
input[type="checkbox"] {
    width: 20px;
    height: 20px;
    border-radius: 6px; /* üëà –¥–µ–ª–∞–µ—Ç —É–≥–ª—ã –º—è–≥–∫–∏–º–∏ */
    /*border: 2px solid #9ca3af; *//* —Å–µ—Ä—ã–π –∫–æ–Ω—Ç—É—Ä */
    appearance: none; /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ */
    -webkit-appearance: none;
    outline: none;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

input[type="checkbox"]:checked {
   /* background-color: #2563eb;*/ /* —Å–∏–Ω–∏–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
    /*border-color: #2563eb;*/
}

input[type="checkbox"]:checked::after {
    content: "‚úì";
    color: white;
    font-size: 14px;
    position: absolute;
    top: 0;
    left: 3px;
}

/* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã */

</style>
